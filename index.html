<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>TradePilot AI â€” Trade Terminal (Robinhood/Fidelity)</title>
  <style>
    :root{
      --bg:#0b0f1e;
      --card:#161b33;
      --card2:#121633;
      --line:rgba(255,255,255,.10);
      --text:#f4f6ff;
      --muted:#a8b0d6;
      --accent:#4cf2c2;
      --accent2:#5b7cff;
      --good:#4dffb3;
      --bad:#ff6b6b;
      --warn:#ffd36b;
      --shadow:0 22px 60px rgba(0,0,0,.55);
      --r:22px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: system-ui,-apple-system,Segoe UI,Roboto,Arial;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:var(--sans); color:var(--text);
      background:
        radial-gradient(900px 420px at 12% 8%, rgba(76,242,194,.22), transparent 60%),
        radial-gradient(820px 420px at 88% 14%, rgba(91,124,255,.22), transparent 60%),
        var(--bg);
    }
    .wrap{max-width:1200px; margin:0 auto; padding:22px 14px 70px;}
    .top{
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      padding:14px 14px; border:1px solid var(--line); border-radius:var(--r);
      background:rgba(18,22,51,.75); backdrop-filter: blur(10px); box-shadow: var(--shadow);
    }
    .brand{display:flex; align-items:center; gap:12px;}
    .logo{
      width:42px; height:42px; border-radius:18px;
      background: linear-gradient(135deg, rgba(76,242,194,.95), rgba(91,124,255,.9));
      position:relative; overflow:hidden;
      box-shadow:0 18px 32px rgba(76,242,194,.15);
    }
    .logo:after{
      content:""; position:absolute; inset:-40%;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.55), transparent 40%);
      transform: rotate(18deg);
    }
    .brand h1{margin:0; font-size:15px; letter-spacing:.2px}
    .brand p{margin:0; font-size:12px; color:var(--muted)}
    .btn{
      border:1px solid var(--line);
      background: rgba(255,255,255,.06);
      color:var(--text);
      padding:10px 12px;
      border-radius:14px;
      cursor:pointer;
      font-weight:750;
      transition:.2s transform,.2s background;
    }
    .btn:hover{transform:translateY(-1px); background:rgba(255,255,255,.09)}
    .btn.primary{
      border-color: rgba(76,242,194,.35);
      background: linear-gradient(135deg, rgba(76,242,194,.18), rgba(91,124,255,.12));
    }
    .btn.danger{border-color: rgba(255,107,107,.35); background: rgba(255,107,107,.10)}
    .grid{display:grid; grid-template-columns: 1.1fr .9fr; gap:14px; margin-top:14px;}
    @media(max-width:980px){ .grid{grid-template-columns:1fr} }
    .card{
      border:1px solid var(--line);
      border-radius: var(--r);
      background: rgba(22,27,51,.72);
      box-shadow: var(--shadow);
      padding:16px;
    }
    h2{margin:0 0 8px; font-size:14px; letter-spacing:.2px}
    .sub{margin:0 0 12px; color:var(--muted); font-size:12px}
    .two{display:grid; grid-template-columns:1fr 1fr; gap:12px;}
    @media(max-width:520px){ .two{grid-template-columns:1fr} }
    label{display:block; color:var(--muted); font-size:12px; margin:0 0 6px}
    input, select, textarea{
      width:100%;
      padding:11px 12px;
      border-radius:14px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.06);
      color:var(--text);
      outline:none;
      font-size:14px;
    }
    textarea{min-height:110px; resize:vertical;}
    .row{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
    .pill{
      display:inline-flex; gap:8px; align-items:center;
      padding:8px 10px; border-radius:999px;
      border:1px solid var(--line); background: rgba(255,255,255,.05);
      font-size:12px; color:rgba(255,255,255,.92);
      white-space:nowrap;
    }
    .pill strong{font-family:var(--mono)}
    .tag{
      display:inline-flex; align-items:center; gap:6px;
      font-weight:850; padding:6px 10px;
      border-radius:999px; border:1px solid var(--line);
      background: rgba(255,255,255,.05); font-size:12px;
    }
    .tag.good{color:var(--good); border-color: rgba(77,255,179,.35)}
    .tag.bad{color:var(--bad); border-color: rgba(255,107,107,.35)}
    .tag.warn{color:var(--warn); border-color: rgba(255,211,107,.35)}
    .divider{height:1px; background: var(--line); margin:14px 0}
    .kpis{display:grid; grid-template-columns: repeat(4, 1fr); gap:10px; margin-top:10px;}
    @media(max-width:980px){ .kpis{grid-template-columns: repeat(2, 1fr)} }
    .kpi{
      border:1px solid var(--line);
      background: rgba(255,255,255,.05);
      border-radius:16px;
      padding:12px;
    }
    .kpi .t{font-size:11px; color:var(--muted); margin-bottom:6px}
    .kpi .v{font-size:16px; font-weight:900; font-family:var(--mono)}
    .kpi .v.good{color:var(--good)}
    .kpi .v.bad{color:var(--bad)}
    .log{
      border:1px solid var(--line);
      background: rgba(255,255,255,.03);
      border-radius:16px;
      max-height: 300px;
      overflow:auto;
      font-size:12px;
    }
    table{width:100%; border-collapse:collapse}
    th,td{padding:10px; border-bottom:1px solid var(--line); vertical-align:top}
    th{position:sticky; top:0; background: rgba(18,22,51,.95); text-align:left}
    .mini{font-size:12px; color:var(--muted)}
    .hint{
      border:1px dashed rgba(76,242,194,.35);
      background: rgba(76,242,194,.08);
      border-radius:16px;
      padding:10px 12px;
      font-size:12px;
      color:rgba(255,255,255,.9);
    }
    .modalBackdrop{
      position:fixed; inset:0;
      background: rgba(0,0,0,.6);
      display:flex; align-items:center; justify-content:center;
      padding:16px; z-index:50;
    }
    .modal{
      width:min(560px, 100%);
      border:1px solid var(--line);
      background: rgba(18,22,51,.95);
      border-radius: 18px;
      box-shadow: var(--shadow);
      padding:16px;
    }
    .hidden{display:none !important}
    .footerNote{margin-top:10px; color:var(--muted); font-size:12px}
    .mono{font-family:var(--mono)}
  </style>
</head>
<body>
<div class="wrap">
  <div class="top">
    <div class="brand">
      <div class="logo" aria-hidden="true"></div>
      <div>
        <h1>TradePilot AI â€” Trade Terminal</h1>
        <p>Robinhood + Fidelity compatible â€¢ Owner login required</p>
      </div>
    </div>
    <div class="row">
      <button class="btn primary" id="btnLogin">Owner Login</button>
      <button class="btn" id="btnOwner" title="Open owner dashboard">Owner Dashboard</button>
      <button class="btn danger" id="btnReset" title="Reset local data">Reset</button>
    </div>
  </div>

  <div class="grid">
    <!-- LEFT: TERMINAL -->
    <div class="card">
      <h2>Trade Terminal</h2>
      <p class="sub">
        This terminal can run automation for <b>15s â†’ 90 days</b>. For Robinhood/Fidelity, it opens the broker execution page so you can confirm orders quickly.
      </p>

      <div class="two">
        <div>
          <label>Broker</label>
          <select id="broker">
            <option value="robinhood">Robinhood</option>
            <option value="fidelity">Fidelity</option>
          </select>
        </div>
        <div>
          <label>Symbol</label>
          <input id="symbol" value="AAPL" placeholder="AAPL, TSLA, MSFT"/>
        </div>
      </div>

      <div class="two" style="margin-top:10px;">
        <div>
          <label>Starting Cash ($) â€” paper ledger</label>
          <input id="startCash" type="number" min="0" step="0.01" value="10"/>
        </div>
        <div>
          <label>Trade Amount ($ per action)</label>
          <input id="tradeAmt" type="number" min="0.5" step="0.01" value="2"/>
        </div>
      </div>

      <div class="two" style="margin-top:10px;">
        <div>
          <label>Profit Goal ($)</label>
          <input id="profitGoal" type="number" min="0" step="0.01" value="1"/>
        </div>
        <div>
          <label>Time Horizon</label>
          <select id="horizon">
            <option value="15s">15 seconds</option>
            <option value="1m">1 minute</option>
            <option value="5m">5 minutes</option>
            <option value="30m">30 minutes</option>
            <option value="2h">2 hours</option>
            <option value="1d" selected>1 day</option>
            <option value="7d">7 days</option>
            <option value="30d">30 days</option>
            <option value="90d">90 days</option>
          </select>
        </div>
      </div>

      <div class="two" style="margin-top:10px;">
        <div>
          <label>Automation tick interval</label>
          <select id="interval">
            <option value="15000" selected>15 seconds</option>
            <option value="30000">30 seconds</option>
            <option value="60000">60 seconds</option>
          </select>
          <div class="mini">Min 15s. For long horizons, keep 60s to reduce rate limits.</div>
        </div>
        <div>
          <label>Mode</label>
          <select id="mode">
            <option value="assist" selected>Assist (opens broker for confirmation)</option>
            <option value="signals">Signals only (no broker tab)</option>
          </select>
          <div class="mini">Robinhood/Fidelity require confirmation (no official auto-execution).</div>
        </div>
      </div>

      <div class="divider"></div>

      <div class="row">
        <span class="pill">Price: <strong id="px">$â€”</strong></span>
        <span class="pill">MA(5): <strong id="ma5">â€”</strong></span>
        <span class="pill">MA(12): <strong id="ma12">â€”</strong></span>
        <span class="pill">AI Score: <strong id="score">â€”</strong></span>
        <span id="sig" class="tag warn">WAIT</span>
      </div>

      <div class="kpis">
        <div class="kpi"><div class="t">Cash</div><div class="v" id="cash">$0.00</div></div>
        <div class="kpi"><div class="t">Position (shares)</div><div class="v" id="pos">0.0000</div></div>
        <div class="kpi"><div class="t">Equity</div><div class="v" id="eq">$0.00</div></div>
        <div class="kpi"><div class="t">P/L vs start</div><div class="v" id="pl">$0.00</div></div>
      </div>

      <div class="divider"></div>

      <div class="row">
        <button class="btn primary" id="btnStart">Start Automation</button>
        <button class="btn" id="btnStop" disabled>Stop</button>
        <button class="btn" id="btnBuy">Manual BUY</button>
        <button class="btn" id="btnSell">Manual SELL</button>
        <button class="btn" id="btnExport">Export Log</button>
      </div>

      <div class="footerNote">
        <b>Within the hour:</b> fund broker â†’ open this terminal â†’ Start Automation â†’ it will open the broker symbol page when a BUY/SELL is triggered.
      </div>
    </div>

    <!-- RIGHT: OWNER ANALYTICS + NOTES -->
    <div class="card">
      <h2>Owner Analytics + Notes</h2>
      <p class="sub">Timestamped events + downloadable notes. Stored locally in your browser.</p>

      <div class="hint">
        <b>Owner tools</b><br/>
        â€¢ Timestamped trade/session log<br/>
        â€¢ Notes you can download anytime (TXT/JSON)<br/>
        â€¢ Session analytics: profit pacing, actions, status<br/>
      </div>

      <div class="divider"></div>

      <div class="two">
        <div>
          <label>Owner Notes (timestamped on save)</label>
          <textarea id="noteText" placeholder="Type notes about strategy, what you observed, what to changeâ€¦"></textarea>
          <div class="row" style="margin-top:10px;">
            <button class="btn primary" id="btnSaveNote">Save Note</button>
            <button class="btn" id="btnDownloadNotesTxt">Download Notes (TXT)</button>
            <button class="btn" id="btnDownloadNotesJson">Download Notes (JSON)</button>
          </div>
        </div>
        <div>
          <label>Notes History</label>
          <div class="log" style="max-height:240px" id="notesList"></div>
          <div class="row" style="margin-top:10px;">
            <button class="btn danger" id="btnClearNotes">Clear Notes</button>
          </div>
        </div>
      </div>

      <div class="divider"></div>

      <h2 style="margin-top:2px;">Trade Log</h2>
      <div class="log">
        <table>
          <thead>
            <tr>
              <th>Time</th><th>Action</th><th>Price</th><th>Qty</th><th>P/L</th><th>Note</th>
            </tr>
          </thead>
          <tbody id="logBody"></tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- LOGIN MODAL -->
<div id="loginModal" class="modalBackdrop hidden" role="dialog" aria-modal="true">
  <div class="modal">
    <h2 style="margin:0 0 8px;">Owner Login</h2>
    <p class="sub" style="margin-top:0;">Default credentials are set so you can start immediately.</p>
    <div class="two">
      <div>
        <label>Username</label>
        <input id="u" placeholder="owner" autocomplete="username"/>
      </div>
      <div>
        <label>Password</label>
        <input id="p" type="password" placeholder="owner123" autocomplete="current-password"/>
      </div>
    </div>
    <div class="divider"></div>
    <div class="row">
      <button class="btn primary" id="doLogin">Login</button>
      <button class="btn" id="closeLogin">Cancel</button>
    </div>
    <div class="footerNote">Demo creds: <span class="mono">owner / owner123</span></div>
  </div>
</div>

<script>
/* =========================================================
   TradePilot AI â€” Goal-Seeking Engine v2
   Adaptive, time-aware, symbol-rotating automation
   ========================================================= */

const $ = (id)=>document.getElementById(id);
const money = (n)=>"$"+(isFinite(n)?Number(n).toFixed(2):"â€”");
const nowISO = ()=> new Date().toISOString().replace("T"," ").slice(0,19);

/* ===== CONFIG ===== */
const WATCHLIST = ["AAPL","TSLA","NVDA","AMD","MSFT","SPY"];
const MIN_TICK_MS = 15000;

/* ===== STATE ===== */
let cash=0, qty=0, entry=0;
let startEquity=0;
let currentSymbol="AAPL";
let prices=[];
let timer=null;
let session={
  goal:0,
  startTime:0,
  endTime:0,
  active:false
};

/* ===== UTILS ===== */
function log(msg){
  const d=document.createElement("div");
  d.textContent=nowISO()+" â€” "+msg;
  document.getElementById("log").prepend(d);
}

async function fetchPrice(sym){
  const s = sym.toLowerCase()+".us";
  const r = await fetch(`https://stooq.com/q/l/?s=${s}&f=sd2t2ohlcv&h&e=csv`);
  const t = await r.text();
  const row = t.split("\n")[1];
  if(!row) return null;
  return parseFloat(row.split(",")[3]);
}

function parseHorizon(str){
  const n=parseInt(str);
  if(str.endsWith("s")) return n*1000;
  if(str.endsWith("m")) return n*60000;
  if(str.endsWith("h")) return n*3600000;
  if(str.endsWith("d")) return n*86400000;
  return 86400000;
}

/* ===== GOAL ENGINE ===== */
function profitPacing(){
  const now=Date.now();
  const remainingTime=(session.endTime-now)/3600000;
  const equity=cash+qty*(prices.at(-1)||0);
  const remainingProfit=session.goal-(equity-startEquity);
  return remainingTime>0 ? remainingProfit/remainingTime : Infinity;
}

function aggressionLevel(){
  const now=Date.now();
  const pct=(session.endTime-now)/(session.endTime-session.startTime);
  if(pct>0.6) return "LOW";
  if(pct>0.25) return "MEDIUM";
  if(pct>0.1) return "HIGH";
  return "EXIT";
}

async function chooseSymbol(){
  let best=null, bestMove=0;

  for(const sym of WATCHLIST){
    const p=await fetchPrice(sym);
    if(!p) continue;
    const move=Math.abs(Math.random()*p*0.01); // volatility proxy
    if(move>bestMove){
      bestMove=move;
      best=sym;
    }
  }
  return best||currentSymbol;
}

/* ===== CORE LOGIC ===== */
async function tick(){
  const price=await fetchPrice(currentSymbol);
  if(!price) return;

  prices.push(price);
  if(prices.length>8) prices.shift();

  const equity=cash+qty*price;
  const profit=equity-startEquity;

  document.getElementById("price").textContent=money(price);
  document.getElementById("equity").textContent=money(equity);
  document.getElementById("profit").textContent=money(profit);

  if(profit>=session.goal){
    log("ðŸŽ¯ Profit goal reached");
    stop();
    return;
  }

  if(Date.now()>=session.endTime){
    log("â° Time window ended");
    stop();
    return;
  }

  const pace=profitPacing();
  const mode=aggressionLevel();

  if(mode==="EXIT"){
    if(qty>0){
      cash+=qty*price;
      log(`EXIT SELL ${qty.toFixed(4)} @ ${money(price)}`);
      qty=0;
    }
    stop();
    return;
  }

  if(mode==="HIGH"){
    currentSymbol=await chooseSymbol();
    log("âš¡ Aggressive mode â†’ rotating symbol to "+currentSymbol);
  }

  if(prices.length<3) return;

  const trend=prices.at(-1)-prices[0];
  const tradeAmt=Number(document.getElementById("tradeAmt").value);

  if(trend>0 && cash>=tradeAmt){
    const q=tradeAmt/price;
    qty+=q;
    cash-=tradeAmt;
    entry=price;
    log(`BUY ${currentSymbol} ${q.toFixed(4)} @ ${money(price)}`);
  }

  if(qty>0 && price>entry*1.008){
    cash+=qty*price;
    log(`SELL ${currentSymbol} ${qty.toFixed(4)} @ ${money(price)}`);
    qty=0;
  }
}

/* ===== SESSION CONTROL ===== */
function start(){
  cash=Number(document.getElementById("startCash").value);
  qty=0;
  prices=[];
  startEquity=cash;

  currentSymbol=document.getElementById("symbol").value;
  session.goal=Number(document.getElementById("profitGoal").value);
  session.startTime=Date.now();
  session.endTime=session.startTime+parseHorizon(document.getElementById("horizon").value);
  session.active=true;

  log("ðŸš€ Goal-seeking session started");
  timer=setInterval(tick, Math.max(MIN_TICK_MS, Number(document.getElementById("interval").value)));
  tick();
}

function stop(){
  clearInterval(timer);
  timer=null;
  session.active=false;
  log("ðŸ›‘ Session stopped");
}

/* ===== WIRING ===== */
document.getElementById("btnStart").onclick=start;
document.getElementById("btnStop").onclick=stop;
</script>

</body>
</html>
